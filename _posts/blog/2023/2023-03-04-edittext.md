---
layout: post
title: "EditText í¬ì»¤ìŠ¤ ë ˆë²¨ì—…"
date: 2023-03-04 23:40:00 +09:00
tag: [Android]
categories:
- blog
- Android
---

ë³¸ ê¸€ì—ì„œëŠ” EditText ì…ë ¥ ì‹œ í¬ì»¤ìŠ¤ì™€ í‚¤ë³´ë“œ í‘œì‹œë¥¼ ë” ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.

<!--more-->

**ğŸš§ğŸš§ğŸš§ í¬ìŠ¤íŒ…ì— ì‚¬ìš©ëœ ë‚´ìš©ì€ í•´ë‹¹ ë™ì‘ë§Œ ì²´í¬í–ˆìŠµë‹ˆë‹¤. ì´ì™¸ì˜ ë‚´ìš©ì€ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ğŸš§ğŸš§ğŸš§**

------

í¬ìŠ¤íŒ…ì— ì‚¬ìš©í•œ ìƒ˜í”Œ ì½”ë“œ : https://github.com/Pluu/EditTextWithContainerSample

------

ì•± ì…ë ¥ í™”ë©´ì—ì„œëŠ” EditTextë¿ë§Œ ì•„ë‹ˆë¼ ê´€ë ¨ ì„¤ëª…ê³¼ ì…ë ¥ ê¸¸ì´ ë° ë²„íŠ¼ ë“± ë‹¤ë¥¸ Viewì™€ í•¨ê»˜ ì•ˆë‚´í•˜ëŠ” ì…ë ¥ í¼ í˜•íƒœì˜ UIê°€ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ° ì…ë ¥ë“¤ì€ EditTextì—ë§Œ ë§ì¶°ì„œ ë…¸ì¶œë˜ê¸°ë³´ë‹¤ëŠ” ê·¸ë£¹ í˜•íƒœë¡œ ë…¸ì¶œë˜ê¸°ë¥¼ ì›í•©ë‹ˆë‹¤.

{% include img_assets.html id="/blog/2023/0304-edittext/001.png" %}

## ê¸°ì¡´ ì…ë ¥ ë°©ì‹ì˜ ë‹¨ì 

ì²˜ìŒ ë³´ì—¬ì¤€ ì…ë ¥ í¼ì²˜ëŸ¼ ViewGroup ë‚´ë¶€ì— EditTextì™€ ë‹¤ë¥¸ Viewë¥¼ ìœ„ì¹˜í•œ ê²½ìš°, EditText í´ë¦­ ì‹œì—ëŠ” EditTextì— ë”± ë§ì¶°ì„œ í™”ë©´ ì´ë™ê³¼ í‚¤ë³´ë“œê°€ ë…¸ì¶œë©ë‹ˆë‹¤. ì…ë ¥í•œ ë¬¸ìì—´ ê¸¸ì´ë¥¼ ë…¸ì¶œí•˜ëŠ” ê²½ìš°ì— ì‚¬ìš©ìê°€ ëª‡ ê¸€ì ì…ë ¥ë˜ì—ˆëŠ”ì§€ ì•Œë ¤ì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´ ì¢‹ì€ UXê°€ ì•„ë‹ ê²ƒì…ë‹ˆë‹¤.

```xml
<LinearLayout ...>
  <androidx.constraintlayout.widget.ConstraintLayout ...>
    <TextView .../>
    <EditText .../>
    <TextView .../>
  </androidx.constraintlayout.widget.ConstraintLayout>
  <LinearLayout ...>
    <EditText ... />
    <Button .../>
  </LinearLayout>
</LinearLayout>
```

{% include youtube.html id="jsErsywS3uo" %}

## ê°œì„  ì‹œë„í•˜ê¸°

### ìœ ì‚¬í•œ ë™ì‘

ì…ë ¥ ë…¸ì¶œì„ í•´ê²° ë°©ë²•ìœ¼ë¡œ ë¹„ìŠ·í•œ UXê°€ Material Designì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. TextInputLayout ë‚´ë¶€ì— TextInputEditTextë¥¼ ë°°ì¹˜í•˜ë©´, TextInputEditText í´ë¦­ ì‹œ TextInputLayout ì˜ì—­ì— ë§ì¶°ì„œ ì…ë ¥ì´ ì œì–´ë˜ê³  ìˆìŠµë‹ˆë‹¤.

> Material Design ~ Text fields : https://m2.material.io/components/text-fields/android#using-text-fields

```xml
<LinearLayout ...>
  <com.google.android.material.textfield.TextInputLayout ...>
    <com.google.android.material.textfield.TextInputEditText .../>
  </com.google.android.material.textfield.TextInputLayout>
</LinearLayout>
```

TextInputLayoutì— OutlinedBoxì™€ counter ì ìš©í•œ í›„, TextInputEditText ì„ íƒ ì‹œ ê¸°ëŒ€ë˜ëŠ” ì˜ì—­(=TextInputLayout)ë§Œí¼ ì´ë™/í‚¤ë³´ë“œ ë…¸ì¶œë˜ê³  ìˆìŠµë‹ˆë‹¤.

{% include youtube.html id="Gw0Ni_U_eGM" %}

ì¶”ê°€ë¡œ TextInputLayoutì— í•˜ë‹¨ ì—¬ë°±ìœ¼ë¡œ 100dpë¥¼ ì¤€ ê²½ìš°ì—ë„ ì—¬ë°±ë§Œí¼ ì´ë™/í‚¤ë³´ë“œ ë…¸ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤.

```xml
<LinearLayout ...>
  <!-- í•˜ë‹¨ 100dp ì—¬ë°± ì¤€ ê²½ìš° -->
  <com.google.android.material.textfield.TextInputLayout
    android:paddingBottom="100dp"
    ...>

    <com.google.android.material.textfield.TextInputEditText .../>
  </com.google.android.material.textfield.TextInputLayout>
</LinearLayout>
```

{% include youtube.html id="I16kR55vuhs" %}

### TextInputEditText ë‚´ë¶€ì˜ ìˆ¨ì€ ê¸°ëŠ¥

ì´ë²ˆ ê¸€ì—ì„œëŠ” TextInputLayoutì˜ ë™ì‘ë³´ë‹¤ëŠ” TextInputEditTextê°€ í•µì‹¬ì…ë‹ˆë‹¤. TextInputEditText ë‚´ë¶€ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ì¼ë¶€ ë™ì‘ì—ì„œ TextInputLayoutë¥¼ ê°€ì ¸ì˜¨ í›„ ë³„ë„ ì²˜ë¦¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

```java
public class TextInputEditText extends AppCompatEditText {
  @Nullable
  private TextInputLayout getTextInputLayout() {
    // ë¶€ëª¨ ë·°ë¡œ ì´ë™í•˜ë©´ì„œ TextInputLayoutë¥¼ ì°¾ìŒ 
    ViewParent parent = getParent();
    while (parent instanceof View) {
      if (parent instanceof TextInputLayout) {
        return (TextInputLayout) parent;
      }
      parent = parent.getParent();
    }
    return null;
  }
  
  @Override
  public void getFocusedRect(@Nullable Rect r) {
    super.getFocusedRect(r);
    TextInputLayout textInputLayout = getTextInputLayout();
    if (shouldUseTextInputLayoutFocusedRect(textInputLayout) && r != null) {
      textInputLayout.getFocusedRect(parentRect);
      r.bottom = parentRect.bottom;
    }
  }

  @Override
  public boolean getGlobalVisibleRect(@Nullable Rect r, @Nullable Point globalOffset) {
    TextInputLayout textInputLayout = getTextInputLayout();
    return shouldUseTextInputLayoutFocusedRect(textInputLayout)
        ? textInputLayout.getGlobalVisibleRect(r, globalOffset)
        : super.getGlobalVisibleRect(r, globalOffset);
  }

  @Override
  public boolean requestRectangleOnScreen(@Nullable Rect rectangle) {
    TextInputLayout textInputLayout = getTextInputLayout();
    if (shouldUseTextInputLayoutFocusedRect(textInputLayout) && rectangle != null) {
      int bottomOffset = textInputLayout.getHeight() - getHeight();
      parentRect.set(
          rectangle.left,
          rectangle.top,
          rectangle.right,
          rectangle.bottom + bottomOffset);
      return super.requestRectangleOnScreen(parentRect);
    } else {
      return super.requestRectangleOnScreen(rectangle);
    }
  }
}
```

> ì†ŒìŠ¤ ì¶œì²˜ : https://github.com/material-components/material-components-android/blob/master/lib/java/com/google/android/material/textfield/TextInputEditText.java

ëŒ€ë¶€ë¶„ í”í•˜ê²Œ ì¬ì •ì˜í•˜ì§€ ì•Šì§€ë§Œ, TextInputLayoutì™€ì˜ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ 3ê°œì˜ í•¨ìˆ˜ë¥¼ ì¬ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- [getFocusedRect](https://developer.android.com/reference/android/view/View#getFocusedRect(android.graphics.Rect)) : Viewì˜ Focused ìƒíƒœì— ë”°ë¼ í‘œì‹œí•  ì˜ì—­ì„ ì •ì˜
- [getGlobalVisibleRect](https://developer.android.com/reference/android/view/View#getGlobalVisibleRect(android.graphics.Rect,%20android.graphics.Point)) : ì•± í™”ë©´ ì˜ì—­ì„ ê¸°ì¤€ìœ¼ë¡œ Viewì˜ í‘œì‹œí•  ì˜ì—­ì„ ì •ì˜
- [requestRectangleOnScreen](https://developer.android.com/reference/android/view/View#requestRectangleOnScreen(android.graphics.Rect)) : Viewì˜ ì§ì‚¬ê°í˜•ì„ í™”ë©´ì— í‘œì‹œí•˜ë„ë¡ ìš”ì²­í•˜ê³ , í•„ìš”í•œ ê²½ìš° í•„ìš”í•œ ë§Œí¼ë§Œ ìŠ¤í¬ë¡¤

ì´ 3ê°œì˜ í•¨ìˆ˜ë§Œ ìˆìœ¼ë©´ ì›í•˜ëŠ” í˜•íƒœë¡œ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ê°œì„  ë²„ì „

ë¨¼ì € ê°œì„ í•œ ì˜ìƒì„ ë³´ê² ìŠµë‹ˆë‹¤.

```xml
<LinearLayout ...>
  <com.pluu.view.edittext.EditTextWithContainer .../>
  <Button ... />
</LinearLayout>
```

{% include youtube.html id="GuLcIVPmddk" %}

### ê°œì„ í•œ EditText ì½”ë“œ

TextInputEditTextì—ì„œëŠ” TextInputLayoutê°€ í•„ìš”í–ˆì§€ë§Œ, ë³„ë„ë¡œ ViewGroupëŒ€ì‹  ê¸°ì¡´ ViewGroupì„ ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆë„ë¡ ìš°íšŒí•˜ëŠ” ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤. ê·¸ë¡œ ì¸í•´ í¬ì»¤ìŠ¤ ì˜ì—­ì„ ì§€ì •í•  ë³„ë„ ViewGroupì„ ë°›ì„ ìˆ˜ ìˆëŠ” ë³€ìˆ˜ì™€ Setterë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```kotlin
class EditTextWithContainer @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = android.R.attr.editTextStyle
) : AppCompatEditText(context, attrs, defStyleAttr) {

    private val parentRect = Rect()
    // EditText ëŒ€ì‹  ë³„ë„ë¡œ í¬ì»¤ìŠ¤/í‚¤ë³´ë“œ ë…¸ì¶œì— ì‚¬ìš©í•  Parent View
    private var parentView: WeakReference<View>? = null

    private fun getContainer(): View? = parentView?.get()
  
    ///////////////////////////////////////////////////////////////////////////
    // ì•„ë˜ ì¬ì •ì˜í•œ í•¨ìˆ˜ëŠ” TextInputEditTextì™€ ìœ ì‚¬í•˜ê²Œ ì½”ë“œ ìˆ˜ì •
    ///////////////////////////////////////////////////////////////////////////

    override fun getFocusedRect(r: Rect?) {
        super.getFocusedRect(r)
        val container = getContainer() ?: return
        if (r != null) {
            container.getFocusedRect(parentRect)
            r.bottom = parentRect.bottom
        }
    }

    override fun getGlobalVisibleRect(r: Rect?, globalOffset: Point?): Boolean {
        val container = getContainer()
        return container?.getGlobalVisibleRect(r, globalOffset)
            ?: super.getGlobalVisibleRect(r, globalOffset)
    }

    override fun requestRectangleOnScreen(rectangle: Rect?): Boolean {
        val container = getContainer()
        return if (container != null && rectangle != null) {
            val bottomOffset = container.height - height
            parentRect.set(
                rectangle.left,
                rectangle.top,
                rectangle.right,
                rectangle.bottom + bottomOffset
            )
            super.requestRectangleOnScreen(parentRect)
        } else {
            super.requestRectangleOnScreen(rectangle)
        }
    }

    fun setParentContainer(view: View) {
        // ì™¸ë¶€ë¡œ ì£¼ì…ëœ Viewë¥¼ ë‚´ë¶€ì— ì„ì‹œ ì €ì¥í•˜ë¯€ë¡œ
        // ì£¼ì…ëœ Viewê°€ ë³€ë™ìœ¼ë¡œ í¬ë˜ì‹œ ë° ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡
        // ì•½í•œ ì°¸ì¡°ë¡œ View ì²˜ë¦¬
        this.parentView = WeakReference(view)
    }
}
```

### Activity ì½”ë“œ

EditTextì— í¬ì»¤ìŠ¤ ìš©ë„ë¡œ ì²˜ë¦¬í•  ë³„ë„ ë·°ë¥¼ ì£¼ì…ë§Œ í•˜ë©´ í•  ì¼ì€ ëë‚¬ìŠµë‹ˆë‹¤. ì‹¤í–‰ í›„ EditText ì„ íƒ ì‹œ ì›í•˜ëŠ” ì…ë ¥ í¼ì´ ìœ ì§€ë˜ë©´ì„œ ì´ë™/í‚¤ë³´ë“œ ë…¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
class MainActivity : AppCompatActivity() {
  private lateinit var binding: ActivityMainBinding
  override fun onCreate(savedInstanceState: Bundle?) {
    ...
    binding.editTextWithContainer.setParentContainer(binding.container)
  }
}
```

## ì •ë¦¬

EditTextë¥¼ ìì£¼ ì‚¬ìš©í•˜ì§€ë§Œ, ì…ë ¥ ì‹œ ì•„ì‰¬ìš´ í‚¤ë³´ë“œì™€ UI ë…¸ì¶œì„ ê°œì„ ì€ ì—¬ì „íˆ ì–´ë ¤ìš´ ì˜ì—­ì…ë‹ˆë‹¤. ë³¸ ê¸€ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šì€ ì ‘ê·¼ì„±, í¬ì»¤ìŠ¤ ì´ë™ ë“±ì— ëŒ€í•´ í…ŒìŠ¤íŠ¸ëŠ” í•´ë³´ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ í•´ë‹¹ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ì´í•´í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. ìœ„ ë‚´ìš©ì´ ë‹¤ë¥¸ ë¶„ë“¤ì—ê²Œë„ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•©ë‹ˆë‹¤.
